\documentclass[11pt]{book}

% Used by cover/title pages and PDF attributes
\newcommand{\booktitle}{Controls Engineering in the FIRST Robotics Competition}
\newcommand{\bookdisplaytitle}%
  {Controls Engineering in the\\FIRST Robotics Competition}
\newcommand{\bookauthor}{Tyler Veness}

\usepackage{amsmath,amssymb,amsthm}
\DeclareMathOperator*{\argmax}{arg\,max}
\DeclareMathOperator*{\argmin}{arg\,min}
\DeclareMathOperator{\cov}{cov}
\DeclareMathOperator{\eig}{eig}
\DeclareMathOperator{\rank}{rank}
\DeclareMathOperator{\sgn}{sgn}
\DeclareMathOperator{\sinc}{sinc}
\DeclareMathOperator{\solve}{solve}
\DeclareMathOperator{\std}{std}
\DeclareMathOperator{\tr}{tr}
\DeclareMathOperator{\var}{var}

\usepackage{mathtools} % For \DeclarePairedDelimiter
\DeclarePairedDelimiter{\norm}{\lVert}{\rVert}

\usepackage[english]{babel} % English language/hyphenation
\usepackage{bm}
\usepackage{booktabs} % For nicer horizontal rules in tables
\usepackage{calc} % For simpler calculation in spacing index letter headings
\usepackage{colortbl} % For colored table rows
\usepackage{csquotes} % Suppress warning from babel about missing csquotes
\usepackage{fancyhdr} % For the headers
\usepackage{float} % For preventing figure floating

\usepackage[bottom]{footmisc} % Put footnotes at bottom of the page
\renewcommand{\thefootnote}{[\arabic{footnote}]} % "[]" around footnote markers

\usepackage{textcomp,gensymb} % For degree symbol
\usepackage[top=3cm,
            bottom=3cm,
            left=3cm,
            right=3cm,
            headsep=10pt,
            marginpar=70pt,
            a4paper]{geometry}
\usepackage{graphicx} % For including figures
\graphicspath{{build/printer/imgs/}} % Specifies directory where images are stored
\usepackage{imakeidx} % For \indexsetup command to fix index heading style
\usepackage{listings}
\usepackage{mathtools} % For \prescript{}
\usepackage{makeidx}
\usepackage{parskip}
\usepackage{placeins} % For FloatBarrier command
\usepackage{subcaption}
\usepackage{tikz}
\usepackage{titletoc}

\usepackage{enumitem} % Customize lists
\setlist{nolistsep} % Reduce spacing between bullet points and numbered lists

% Font setup
\usepackage{microtype} % Slightly tweak font spacing for aesthetics
\usepackage[T1]{fontenc} % Use 8-bit encoding that has 256 glyphs

% Set main fonts
\usepackage[no-math]{fontspec}
\setmainfont[Path=./fonts/,
             BoldFont=FreeSerifBold.ttf,
             ItalicFont=FreeSerifItalic.ttf,
             BoldItalicFont=FreeSerifBoldItalic.ttf]{FreeSerif.ttf}
\setsansfont[Path=./fonts/,
             BoldFont=FreeSansBold.ttf,
             ItalicFont=FreeSansOblique.ttf,
             BoldItalicFont=FreeSansBoldOblique.ttf]{FreeSans.ttf}
\renewcommand{\familydefault}{\rmdefault}

% Bibliography setup
\usepackage[style=numeric,
            citestyle=numeric,
            defernumbers=true,
            sorting=nyt,
            sortcites=true,
            autopunct=true,
            autolang=hyphen,
            hyperref=true,
            abbreviate=false,
            backref=true,
            backend=biber]{biblatex}
\addbibresource{controls-engineering-in-frc.bib}
\defbibheading{bibempty}{}

% Index setup
\makeindex
\indexsetup{othercode={\fancyhead[LO,RE]{\sffamily\bfseries Index}}}

\usepackage{hyperref}
\hypersetup{hidelinks,colorlinks=false,breaklinks=true,bookmarksopen=false,
  pdftitle=\booktitle,pdfauthor=\bookauthor}
\urlstyle{same}

% Load after hyperref
\usepackage[nopostdot,
            style=index,
            nonumberlist]{glossaries}

\input{preamble/styles}
\input{preamble/macros}
\input{preamble/layout}

\renewcommand*{\glstextformat}[1]{\textcolor{glscolor}{#1}}
\input{glossary-entries}
\makeglossaries
\begin{document}
% \usechapterimagefalse
\frontmatter
\input{frontmatter/cover}
\input{frontmatter/title}
\input{frontmatter/copyright}
\input{frontmatter/toc}

% Frontmatter fancy header
\renewcommand{\chaptermark}[1]{%
  \markboth{\sffamily\normalsize\bfseries #1}
           {\sffamily\normalsize\bfseries #1}}
\renewcommand{\sectionmark}[1]{%
  \markright{\sffamily\normalsize\bfseries #1}
            {\sffamily\normalsize\bfseries #1}}

\input{frontmatter/preface}

% Mainmatter fancy header
\renewcommand{\chaptermark}[1]{%
  \markboth{\sffamily\normalsize\bfseries\chaptername\ \thechapter.\ #1}{}}
\renewcommand{\sectionmark}[1]{%
  \markright{\sffamily\normalsize\thesection\hspace{5pt}#1}{}}

% Define path commands for redefinition later
\newcommand*{\partpath}{}
\newcommand*{\chapterpath}{}
\newcommand*{\sectionpath}{}

\mainmatter
\setcounter{chapter}{-1}

\renewcommand*{\partpath}{introduction}
\input{\partpath/notes-to-the-reader}

\part{Fundamentals of control theory}
\label{part:fundamentals_of_control_theory}
\renewcommand*{\partpath}{fundamentals-of-control-theory}
\input{\partpath/control-system-basics}
\input{\partpath/pid-controllers}
\input{\partpath/application-advice}
\input{\partpath/calculus}

\part{Modern control theory}
\label{part:modern_control_theory}
\renewcommand*{\partpath}{modern-control-theory}
\input{\partpath/linear-algebra}
\input{\partpath/continuous-state-space-control}
\input{\partpath/discrete-state-space-control}
\input{\partpath/nonlinear-control}

\part{Estimation and localization}
\label{part:estimation_and_localization}
\renewcommand*{\partpath}{estimation-and-localization}
\input{\partpath/stochastic-control-theory}
\input{\partpath/pose-estimation}

\part{System modeling}
\label{part:system_modeling}
\renewcommand*{\partpath}{system-modeling}
\input{\partpath/dynamics}
\input{\partpath/newtonian-mechanics-examples}
\input{\partpath/lagrangian-mechanics-examples}
\input{\partpath/system-identification}

\part{Motion planning}
\label{part:motion_planning}
\renewcommand*{\partpath}{motion-planning}
\input{\partpath/motion-profiles}
\input{\partpath/configuration-spaces}
\input{\partpath/trajectory-optimization}

\part{Appendices}
\renewcommand{\chaptermark}[1]{\markboth{\sffamily\normalsize\bfseries\appendixname\ \thechapter.\ #1}{}}
\appendix
\renewcommand*{\partpath}{appendices}
\input{\partpath/simplifying-block-diagrams}
\input{\partpath/linear-quadratic-regulator}
\input{\partpath/feedforwards}
\input{\partpath/derivations}
\input{\partpath/classical-control-theory}

% Backmatter fancy header
\renewcommand{\chaptermark}[1]{%
  \markboth{\sffamily\normalsize\bfseries #1}
           {\sffamily\normalsize\bfseries #1}}
\renewcommand{\sectionmark}[1]{%
  \markright{\sffamily\normalsize\bfseries #1}
            {\sffamily\normalsize\bfseries #1}}

\backmatter
\chapterimage{backmatter.jpg}{Sunset near Porter Academic building at UCSC}
\input{backmatter/glossary}
\input{backmatter/bibliography}
\input{backmatter/index}
\input{backmatter/cover}
\end{document}
