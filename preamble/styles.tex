\usepackage{xcolor}  % Required for specifying colors by name
\definecolor{deepred}{rgb}{0.6,0,0}
\definecolor{deeporange}{RGB}{243,102,25}
\definecolor{deepgreen}{rgb}{0,0.5,0}
\definecolor{deepblue}{rgb}{0,0,0.5}

\definecolor{coverblue}{RGB}{56,107,166}
\colorlet{themecolor}{coverblue}
\colorlet{headingbg}{black!5}
\colorlet{glscolor}{black!50!white!80!blue}

% MAIN TABLE OF CONTENTS

\contentsmargin{0cm} % Removes the default margin

% Part text styling
\titlecontents{part}[0cm]{\addvspace{20pt}\centering\large\bfseries}{}{}{}

% Chapter text styling
\titlecontents{chapter}[1.25cm] % Indentation
  {\addvspace{12pt}\large\sffamily\bfseries} % Spacing and font options
  {\color{themecolor!60}\contentslabel[\Large\thecontentslabel]{1.25cm}%
   \color{themecolor}} % Chapter number
  {\color{themecolor}}
  {\color{themecolor!60}\normalsize\;%
   \titlerule*[.5pc]{.}\;\thecontentspage} % Page number

% Section text styling
\titlecontents{section}[1.25cm] % Indentation
  {\addvspace{3pt}\sffamily\bfseries} % Spacing and font options
  {\contentslabel[\thecontentslabel]{1.25cm}} % Section number
  {}
  {\hfill\color{black}\thecontentspage} % Page number
  []

% Subsection text styling
\titlecontents{subsection}[1.25cm] % Indentation
  {\addvspace{1pt}\sffamily\small} % Spacing and font options
  {\contentslabel[\thecontentslabel]{1.25cm}} % Subsection number
  {}
  {\ \titlerule*[.5pc]{.}\;\thecontentspage} % Page number
  []

% List of figures
\titlecontents{figure}[0em]
  {\addvspace{-5pt}\sffamily}
  {\thecontentslabel\hspace*{1em}}
  {}
  {\ \titlerule*[.5pc]{.}\;\thecontentspage}
  []

% List of tables
\titlecontents{table}[0em]
  {\addvspace{-5pt}\sffamily}
  {\thecontentslabel\hspace*{1em}}
  {}
  {\ \titlerule*[.5pc]{.}\;\thecontentspage}
  []

% List of snippets
\titlecontents{snippet}[0em]
  {\addvspace{-5pt}\sffamily}
  {\thecontentslabel\hspace*{1em}}
  {}
  {\ \titlerule*[.5pc]{.}\;\thecontentspage}
  []

% MINI TABLE OF CONTENTS IN PART HEADS

% Chapter text styling
\titlecontents{lchapter}[0em] % Indentation
  {\addvspace{15pt}\large\sffamily\bfseries} % Spacing and font options
  {\color{themecolor}\contentslabel[\Large\thecontentslabel]{1.25cm}
   \color{themecolor}} % Chapter number
  {\color{themecolor}}
  {\color{themecolor}\normalsize\sffamily\bfseries\;%
   \titlerule*[.5pc]{.}\;\thecontentspage} % Page number

% Section text styling
\titlecontents{lsection}[0em] % Indentation
  {\sffamily\small} % Spacing and font options
  {\contentslabel[\thecontentslabel]{1.25cm}} % Section number
  {}
  {}

% Subsection text styling
\titlecontents{lsubsection}[.5em] % Indentation
  {\normalfont\footnotesize\sffamily} % Font settings
  {}
  {}
  {}

% THEOREM STYLES

\makeatletter
\newcommand{\intoo}[2]{\mathopen{]}#1\,;#2\mathclose{[}}
\newcommand{\ud}{\mathop{\mathrm{{}d}}\mathopen{}}
\newcommand{\intff}[2]{\mathopen{[}#1\,;#2\mathclose{]}}
\newtheorem{notation}{Notation}[chapter]

% Boxed/framed environments
\newtheoremstyle{themecolornumbox} % Theorem style name
  {5pt} % Space above
  {5pt} % Space below
  {\normalfont} % Body font
  {} % Indent amount
  {\small\bf\sffamily\color{themecolor}} % Theorem head font
  {\;} % Punctuation after theorem head
  {0.25em} % Space after theorem head
  {\small\sffamily\color{themecolor}\thmname{#1}\nobreakspace%
   \thmnumber{\@ifnotempty{#1}{}\@upn{#2}} % Theorem text (e.g. Theorem 2.1)
   \thmnote{\nobreakspace\the\thm@notefont\sffamily\bfseries%
            \color{black}---\nobreakspace#3.}
  } % Optional theorem note
\renewcommand{\qedsymbol}{$\blacksquare$} % Optional qed square

\newtheoremstyle{blacknumex} % Theorem style name
  {5pt} % Space above
  {5pt} % Space below
  {\normalfont} % Body font
  {} % Indent amount
  {\small\bf\sffamily} % Theorem head font
  {\;} % Punctuation after theorem head
  {0.25em} % Space after theorem head
  {\small\sffamily{\tiny\ensuremath{\blacksquare}}\nobreakspace%
   \thmname{#1}\nobreakspace%
   \thmnumber{\@ifnotempty{#1}{}\@upn{#2}} % Theorem text (e.g. Theorem 2.1)
   \thmnote{\nobreakspace\the\thm@notefont%
            \sffamily\bfseries---\nobreakspace#3.}} % Optional theorem note

\newtheoremstyle{blacknumbox} % Theorem style name
  {5pt} % Space above
  {5pt} % Space below
  {\normalfont} % Body font
  {} % Indent amount
  {\small\bf\sffamily} % Theorem head font
  {\;} % Punctuation after theorem head
  {0.25em} % Space after theorem head
  {\small\sffamily\thmname{#1}\nobreakspace%
   \thmnumber{\@ifnotempty{#1}{}\@upn{#2}} % Theorem text (e.g. Theorem 2.1)
   \thmnote{\nobreakspace\the\thm@notefont%
            \sffamily\bfseries---\nobreakspace#3.}} % Optional theorem note

% Non-boxed/non-framed environments
\newtheoremstyle{themecolornum} % Theorem style name
  {5pt} % Space above
  {5pt} % Space below
  {\normalfont} % Body font
  {} % Indent amount
  {\small\bf\sffamily\color{themecolor}} % Theorem head font
  {\;} % Punctuation after theorem head
  {0.25em} % Space after theorem head
  {\small\sffamily\color{themecolor}\thmname{#1}\nobreakspace%
   \thmnumber{\@ifnotempty{#1}{}\@upn{#2}} % Theorem text (e.g. Theorem 2.1)
  \thmnote{\nobreakspace\the\thm@notefont\sffamily\bfseries%
           \color{black}---\nobreakspace#3.}} % Optional theorem note
\renewcommand{\qedsymbol}{$\blacksquare$} % Optional qed square
\makeatother

% Defines the theorem text style for each type of theorem to one of the three
% styles above
\newcounter{dummy}
\numberwithin{dummy}{section}
\theoremstyle{themecolornumbox}
\newtheorem{theoremeT}[dummy]{Theorem}
\newtheorem{problem}{Problem}[chapter]
\newtheorem{exerciseT}{Exercise}[chapter]
\theoremstyle{blacknumex}
\newtheorem{exampleT}{Example}[chapter]
\theoremstyle{blacknumbox}
\newtheorem{vocabulary}{Vocabulary}[chapter]
\newtheorem{definitionT}{Definition}[section]
\newtheorem{corollaryT}[dummy]{Corollary}
\theoremstyle{themecolornum}
\newtheorem{proposition}[dummy]{Proposition}

% DEFINITION OF COLORED BOXES

% For creating the theorem, definition, exercise, and corollary boxes
\RequirePackage[framemethod=default,nobreak=true]{mdframed}

% Theorem box
\newmdenv[skipabove=7pt,
          skipbelow=7pt,
          backgroundcolor=black!5,
          linecolor=themecolor,
          innerleftmargin=5pt,
          innerrightmargin=5pt,
          innertopmargin=5pt,
          leftmargin=0cm,
          rightmargin=0cm,
          innerbottommargin=5pt]{tBox}

% Exercise box
\newmdenv[skipabove=7pt,
          skipbelow=7pt,
          rightline=false,
          leftline=true,
          topline=false,
          bottomline=false,
          backgroundcolor=themecolor!10,
          linecolor=themecolor,
          innerleftmargin=5pt,
          innerrightmargin=5pt,
          innertopmargin=5pt,
          innerbottommargin=5pt,
          leftmargin=0cm,
          rightmargin=0cm,
          linewidth=4pt]{eBox}

% Definition box
\newmdenv[skipabove=7pt,
          skipbelow=7pt,
          rightline=false,
          leftline=true,
          topline=false,
          bottomline=false,
          linecolor=themecolor,
          innerleftmargin=5pt,
          innerrightmargin=5pt,
          innertopmargin=2.5pt,
          leftmargin=0cm,
          rightmargin=0cm,
          linewidth=4pt,
          innerbottommargin=2.5pt]{dBox}

% Corollary box
\newmdenv[skipabove=7pt,
          skipbelow=7pt,
          rightline=false,
          leftline=true,
          topline=false,
          bottomline=false,
          linecolor=gray,
          backgroundcolor=black!5,
          innerleftmargin=5pt,
          innerrightmargin=5pt,
          innertopmargin=5pt,
          leftmargin=0cm,
          rightmargin=0cm,
          linewidth=4pt,
          innerbottommargin=5pt]{cBox}

% Creates an environment for each type of theorem and assigns it a theorem text
% style from the "Theorem Styles" section above and a colored box from above
\newenvironment{theorem}{\begin{tBox}\begin{theoremeT}}%
  {\end{theoremeT}\end{tBox}}
\newenvironment{exercise}{\begin{eBox}\begin{exerciseT}}%
  {\hfill{\color{themecolor}\tiny\ensuremath{\blacksquare}}%
   \end{exerciseT}\end{eBox}}
\newenvironment{definition}{\begin{dBox}\begin{definitionT}}%
  {\end{definitionT}\end{dBox}}
\newenvironment{example}{\begin{exampleT}}%
  {\hfill{\tiny\ensuremath{\blacksquare}}\end{exampleT}}
\newenvironment{corollary}{\begin{cBox}\begin{corollaryT}}%
  {\end{corollaryT}\end{cBox}}

% REMARK ENVIRONMENT

\newenvironment{remark}{\par\vspace{10pt}\small % Vertical white space above the remark and smaller font size
  \begin{list}{}{
    \leftmargin=35pt % Indentation on the left
    \rightmargin=25pt}\item\ignorespaces % Indentation on the right
    \makebox[-2.5pt]{%
      \begin{tikzpicture}[overlay]
        \node[draw=themecolor!60,line width=1pt,circle,fill=themecolor!25,font=\sffamily\bfseries,inner sep=2pt,outer sep=0pt] at (-15pt,0pt)%
          {\textcolor{themecolor}{R}}; % Orange R in a circle
      \end{tikzpicture}%
    }
    \advance\baselineskip -1pt}%
  {\end{list}\vskip5pt} % Tighter line spacing and white space after remark

% SECTION NUMBERING IN THE MARGIN

\makeatletter
\renewcommand{\@seccntformat}[1]{\textcolor{themecolor}%
  {\csname the#1\endcsname}\hspace{1em}}
\renewcommand{\section}{\@startsection{section}{1}{\z@}
  {-4ex \@plus -1ex \@minus -.4ex}
  {1ex \@plus.2ex}
  {\normalfont\large\sffamily\bfseries}}
\renewcommand{\subsection}{\@startsection {subsection}{2}{\z@}
  {-3ex \@plus -0.1ex \@minus -.4ex}
  {0.5ex \@plus.2ex}
  {\normalfont\sffamily\bfseries}}
\renewcommand{\subsubsection}{\@startsection {subsubsection}{3}{\z@}
  {-2ex \@plus -0.1ex \@minus -.2ex}
  {.2ex \@plus.2ex}
  {\normalfont\small\sffamily\bfseries}}
\renewcommand\paragraph{\@startsection{paragraph}{4}{\z@}
  {-2ex \@plus-.2ex \@minus .2ex}
  {.1ex}
  {\normalfont\small\sffamily\bfseries}}

% PART HEADINGS

% numbered part in the table of contents
\newcommand{\@mypartnumtocformat}[2]{%
  \setlength\fboxsep{0pt}%
  \noindent\colorbox{themecolor!20}{%
    \strut\parbox[c][.7cm]{\ecart}{%
      \color{themecolor!70}\Large\sffamily\bfseries\centering#1}}%
  \hskip\esp\colorbox{themecolor!40}{%
    \strut\parbox[c][.7cm]{\linewidth-\ecart-\esp}{%
      \Large\sffamily\centering#2}}}%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% unnumbered part in the table of contents
\newcommand{\@myparttocformat}[1]{%
  \setlength\fboxsep{0pt}%
  \noindent\colorbox{themecolor!40}{%
    \strut\parbox[c][.7cm]{\linewidth}{%
      \Large\sffamily\centering#1}}}%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newlength\esp
\setlength\esp{4pt}
\newlength\ecart
\setlength\ecart{1.2cm-\esp}
\newcommand{\thepartimage}{}%
\newcommand{\partimage}[1]{\renewcommand{\thepartimage}{#1}}%
\def\@part[#1]#2{%
  \ifnum \c@secnumdepth >-2\relax%
    \refstepcounter{part}%
    \NR@gettitle{#1}%
    \addcontentsline{toc}{part}{%
      \texorpdfstring{\protect\@mypartnumtocformat{\thepart}{#1}}{%
        \partname~\thepart\ ---\ #1}}
  \else%
    \NR@gettitle{#1}%
    \addcontentsline{toc}{part}{%
      \texorpdfstring{\protect\@myparttocformat{#1}}{#1}}%
  \fi%
  \startcontents%
  \markboth{}{}%
  {%
    \thispagestyle{empty}%
    \begin{tikzpicture}[remember picture,overlay]%
      \node at (current page.north west){%
        \begin{tikzpicture}[remember picture,overlay]%
          \fill[themecolor!20](0cm,0cm) rectangle (\paperwidth,-\paperheight);
          \node[anchor=north] at (4cm,-3.25cm){%
            \color{themecolor!40}\fontsize{220}{100}\sffamily\bfseries\thepart};
          \node[anchor=south east] at (\paperwidth-1cm,-\paperheight+1cm){%
            \parbox[t][][t]{8.5cm}{%
              \printcontents{l}{0}{%
                % Sets max depth for part table of contents
                \setcounter{tocdepth}{0}%
              }%
              % Resets max depth for normal table of contents
              \setcounter{tocdepth}{1}%
            }%
          };
          \node[anchor=north east] at (\paperwidth-1.5cm,-3.25cm){%
            \parbox[t][][t]{\paperwidth-5cm}{%
              \strut\raggedleft\color{white}\fontsize{30}{30}\sffamily\bfseries#2}};
        \end{tikzpicture}
      };
    \end{tikzpicture}%
  }%
\@endpart}
\def\@spart#1{%
  \startcontents%
  \phantomsection
  {%
  \thispagestyle{empty}%
  \begin{tikzpicture}[remember picture,overlay]%
    \node at (current page.north west){%
      \begin{tikzpicture}[remember picture,overlay]%
        \fill[themecolor!20](0cm,0cm) rectangle (\paperwidth,-\paperheight);
        \node[anchor=north east] at (\paperwidth-1.5cm,-3.25cm){%
          \parbox[t][][t]{\paperwidth-5cm}{%
            \strut\raggedleft\color{white}\fontsize{30}{30}\sffamily\bfseries#1}
        };
      \end{tikzpicture}
    };
  \end{tikzpicture}%
  }
  \NR@gettitle{#1}%
  \addcontentsline{toc}{part}{\texorpdfstring{%
    \setlength\fboxsep{0pt}%
    \noindent\protect\colorbox{themecolor!40}{%
      \strut\protect\parbox[c][.7cm]{\linewidth}{%
        \Large\sffamily\protect\centering #1\quad\mbox{}}}}{#1}
  }%
\@endpart}
\def\@endpart{%
  \vfil\newpage
  \if@twoside
    \if@openright
      \vspace*{\stretch{1}}
      \begin{center}
        \textit{This page intentionally left blank}
      \end{center}
      \vspace*{\stretch{4}}
      \null
      \thispagestyle{empty}%
      \newpage
    \fi
  \fi
  \if@tempswa
    \twocolumn
  \fi%
}

% CHAPTER HEADINGS

% A switch to conditionally include a picture
\newif\ifusechapterimage
\usechapterimagetrue
\newcommand{\thechapterimage}{}%
\newcommand{\thechapterimagecaption}{}%
\newcommand{\chapterimage}[2]{%
  \ifusechapterimage\renewcommand{\thechapterimage}{#1}%
  \renewcommand{\thechapterimagecaption}{#2}\fi}%
\newcommand{\autodot}{.}
\def\@makechapterhead#1{{%
  \parindent \z@ \raggedright \normalfont
  \ifnum \c@secnumdepth >\m@ne
    \begin{tikzpicture}[remember picture,overlay]
      \node at (current page.north west){%
        \begin{tikzpicture}[remember picture,overlay]
          \node[anchor=north west,inner sep=0pt] at (0,0)%
            {\ifusechapterimage\includegraphics[width=\paperwidth]%
             {\thechapterimage}\fi};
          \draw[anchor=west] (\paperwidth*0.6,-0.5cm) node [line width=2pt,%
              rounded corners=5pt,fill=white,fill opacity=0.5,%
              inner sep=0.5pt]{\strut\makebox[8.5cm]{}};
          \draw[anchor=west] (\paperwidth*0.6,-0.5cm) node%
            {\tiny\sffamily\bfseries\itshape\color{black}\thechapterimagecaption};
          \draw[anchor=west] (\Gm@lmargin,-6cm) node%
            [line width=2pt,rounded corners=15pt,draw=themecolor,fill=white,%
             fill opacity=0.5,inner sep=15pt]{\strut\makebox[22cm]{}};
          \draw[anchor=west] (\Gm@lmargin+.3cm,-6cm) node%
            {\huge\sffamily\bfseries\color{black}%
            \if@mainmatter\thechapter\autodot~\fi#1\strut};
        \end{tikzpicture}%
      };
    \end{tikzpicture}
  \fi\par\vspace*{200\p@}}}

%-------------------------------------------

\def\@makeschapterhead#1{%
  \begin{tikzpicture}[remember picture,overlay]
    \node at (current page.north west){%
      \begin{tikzpicture}[remember picture,overlay]
        \node[anchor=north west,inner sep=0pt] at (0,0){%
          \ifusechapterimage
            \includegraphics[width=\paperwidth]{\thechapterimage}
          \fi};
        \draw[anchor=west] (\paperwidth*0.6,-0.5cm) node [line width=2pt,%
            rounded corners=5pt,fill=white,fill opacity=0.5,inner sep=0.5pt]%
            {\strut\makebox[8.5cm]{}};
        \draw[anchor=west] (\paperwidth*0.6,-0.5cm) node%
          {\tiny\sffamily\bfseries\itshape\color{black}\thechapterimagecaption};
        \draw[anchor=west] (\Gm@lmargin,-6cm) node%
          [line width=2pt,rounded corners=15pt,draw=themecolor,fill=white,%
           fill opacity=0.5,inner sep=15pt]{\strut\makebox[22cm]{}};
        \draw[anchor=west] (\Gm@lmargin+.3cm,-6cm) node%
          {\huge\sffamily\bfseries\color{black}#1\strut};
      \end{tikzpicture}%
    };
  \end{tikzpicture}
  \par\vspace*{200\p@}}
\makeatother

\usepackage{bookmark}
\bookmarksetup{open,numbered,addtohook={%
  \ifnum\bookmarkget{level}=0 % chapter
    \bookmarksetup{bold}%
  \fi
  \ifnum\bookmarkget{level}=-1 % part
    \bookmarksetup{color=themecolor,bold}%
  \fi
}
}

% Set styles for TikZ objects
\usetikzlibrary{angles, arrows, calc, circuits.ee.IEC, decorations.markings,
    decorations.pathreplacing, patterns, positioning, quotes, shapes}
\tikzstyle{block} = [draw, fill=headingbg, rectangle, minimum height=3em,
    minimum width=4em]
\tikzstyle{sum} = [draw, circle, node distance=1cm]
\tikzstyle{arrow} = [arrows=->, black, align=right]
\tikzstyle{branch} = [circle, inner sep=0pt, minimum size=1mm, fill=black,
    draw=black]
\tikzstyle{opencircuit} = [circle, draw=black, fill=white, minimum size=3pt,
    inner sep=0pt]

\lstdefinestyle{customMatlab}{
  language=Matlab,
  breaklines=true,
  xleftmargin=0.125in,
  basicstyle=\footnotesize\ttfamily,
  keywordstyle=\color{blue},
  morekeywords=[2]{1}, keywordstyle=[2]{\color{black}},
  identifierstyle=\color{black},
  stringstyle=\color[RGB]{170, 55, 241},
  commentstyle=\color[RGB]{28, 172, 0},
  showstringspaces=false,
  emph=[1]{for,end,break},emphstyle=[1]\color{red},
}

\lstdefinestyle{customPython}{
  language=Python,
  breaklines=true,
  xleftmargin=0.125in,
  basicstyle=\footnotesize\ttfamily,
  otherkeywords={self,True,False},
  keywordstyle=\color{deepblue},
  emph={MyClass,__init__},
  emphstyle=\color{deepred},
  stringstyle=\color{deepgreen},
  showstringspaces=false
}

\lstdefinestyle{customcpp}{
  belowcaptionskip=1\baselineskip,
  breaklines=true,
  xleftmargin=0.125in,
  language=C++,
  showstringspaces=false,
  basicstyle=\footnotesize\ttfamily,
  keywordstyle=\color[RGB]{128, 128, 0},
  commentstyle=\color[RGB]{0, 128, 0},
  identifierstyle=\color{black},
  stringstyle=\color[RGB]{0, 128, 0},
}
